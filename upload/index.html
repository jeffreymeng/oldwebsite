<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Jeffrey Meng">

    <title>Jeffrey Meng - Template</title>

    <!-- Bootstrap Core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="/css/agency.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Kaushan+Script" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700" rel="stylesheet" type="text/css">

    <link href="upload.css" rel="stylesheet" type="text/css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
    <script>
        (function(e, t, n) {
            var r = e.querySelectorAll("html")[0];
            r.className = r.className.replace(/(^|\s)no-js(\s|$)/, "$1js$2")
        })(document, window, 0);
    </script>

</head>

<body id="page-top" class="index">

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top navbar-shrink">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                <a class="navbar-brand page-scroll" href="/index.html">Jeffrey Meng</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li class="hidden active">
                        <a href="#page-top"></a>
                    </li>
                    <li>
                        <a href="/index.html">Home</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/projects">Projects</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/archives">Archives</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>

    <!-- Header -->
    <!--
        <header>
            <div class="container">
                <div class="intro-text">
                    <div class="intro-lead-in">Welcome To My Studio!</div>
                    <div class="intro-heading">It's Nice To Meet You</div>
                </div>
            </div>
        </header> -->

    <section>
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <h2 class="section-heading">Upload Test</h2>
                    <p>Select a file below. When it is uploaded, a link will be displayed to the uploaded file.</p>
                    <h6>Choose File</h6>
                    <form method="post" action="https://css-tricks.com/examples/DragAndDropFileUploading//?submit-on-demand" enctype="multipart/form-data" novalidate class="box">


                        <div class="box__input">
                            <svg class="box__icon" xmlns="http://www.w3.org/2000/svg" width="50" height="43" viewBox="0 0 50 43"><path d="M48.4 26.5c-.9 0-1.7.7-1.7 1.7v11.6h-43.3v-11.6c0-.9-.7-1.7-1.7-1.7s-1.7.7-1.7 1.7v13.2c0 .9.7 1.7 1.7 1.7h46.7c.9 0 1.7-.7 1.7-1.7v-13.2c0-1-.7-1.7-1.7-1.7zm-24.5 6.1c.3.3.8.5 1.2.5.4 0 .9-.2 1.2-.5l10-11.6c.7-.7.7-1.7 0-2.4s-1.7-.7-2.4 0l-7.1 8.3v-25.3c0-.9-.7-1.7-1.7-1.7s-1.7.7-1.7 1.7v25.3l-7.1-8.3c-.7-.7-1.7-.7-2.4 0s-.7 1.7 0 2.4l10 11.6z"/></svg>
                            <input type="file" name="files[]" id="file" class="box__file" />
                            <label for="file"><strong>Choose a file</strong><span class="box__dragndrop"> or drag it here</span>.</label>
                            <button type="submit" class="box__button">Upload</button>
                        </div>


                        <div class="box__uploading">Uploading&hellip;</div>
                        <div class="box__success">Done! <a href="https://css-tricks.com/examples/DragAndDropFileUploading//?submit-on-demand" class="box__restart" role="button">Upload more?</a></div>
                        <div class="box__error">Error! <span></span>. <a href="https://css-tricks.com/examples/DragAndDropFileUploading//?submit-on-demand" class="box__restart" role="button">Try again!</a></div>
                    </form>
                    <h6>File URL:</h6>
                    <span id="linkbox"></span>
                </div>
            </div>
        </div>
    </section>


    <footer>
        <div class="container ">
            <div class="row">
                <div class="col-md-4">
                    <span class="copyright">Copyright &copy; 2016 Jeffrey Meng.</span>
                </div>
                <div class="col-md-4">
                    <ul class="list-inline social-buttons">
                        <li><a href="https://github.com/jeffreymeng"><i class="fa fa-github"></i></a>
                        </li>

                    </ul>
                </div>
                <div class="col-md-4">
                    <ul class="list-inline quicklinks">
                        <li><a href="/archives/">Archives</a>
                        </li>
                        <li><a href="/sitemap.html">Sitemap</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="/js/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/js/bootstrap.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="/js/jquery.easing.min.js"></script>
    <script src="/js/classie.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="/js/agency.js"></script>
    <!-- Dropzone JavaScript -->
    <script src="/js/dropzone.js"></script>

    <script src="https://www.gstatic.com/firebasejs/3.3.0/firebase.js"></script>
    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyCKwBAaeo8kzGBwKyR6TwuI88womFvtRIw",
            authDomain: "jfiles.firebaseapp.com",
            databaseURL: "https://jfiles.firebaseio.com",
            storageBucket: "firebase-jfiles.appspot.com",
        };
        firebase.initializeApp(config);
    </script>
    <script>
        var auth = firebase.auth();
        var storageRef = firebase.storage().ref();
        window.onload = function() {
            auth.onAuthStateChanged(function(user) {
                if (user) {
                    console.log('Anonymous user signed-in.', user);
                    document.getElementById('file').disabled = false;
                }
                else {
                    console.log('There was no anonymous session. Creating a new anonymous user.');
                    // Sign the user in anonymously since accessing Storage requires the user to be authorized.
                    auth.signInAnonymously();
                }
            });
        }

        // feature detection for drag&drop upload

        var isAdvancedUpload = function() {
            var div = document.createElement('div');
            return (('draggable' in div) || ('ondragstart' in div && 'ondrop' in div)) && 'FormData' in window && 'FileReader' in window;
        }();


        // applying the effect for every form

        $('.box').each(function() {
            var $form = $(this),
                $input = $form.find('input[type="file"]'),
                $label = $form.find('label'),
                $errorMsg = $form.find('.box__error span'),
                $restart = $form.find('.box__restart'),
                droppedFiles = false,
                showFiles = function(files) {
                    $label.text(files.length > 1 ? ($input.attr('data-multiple-caption') || '').replace('{count}', files.length) : files[0].name);
                };

            // automatically submit the form on file select
            $input.on('change', function(e) {
                showFiles(e.target.files);


            });


            // drag&drop files if the feature is available
            if (isAdvancedUpload) {
                $form
                    .addClass('has-advanced-upload') // letting the CSS part to know drag&drop is supported by the browser
                    .on('drag dragstart dragend dragover dragenter dragleave drop', function(e) {
                        // preventing the unwanted behaviours
                        e.preventDefault();
                        e.stopPropagation();
                    })
                    .on('dragover dragenter', function() //
                        {
                            $form.addClass('is-dragover');
                        })
                    .on('dragleave dragend drop', function() {
                        $form.removeClass('is-dragover');
                    })
                    .on('drop', function(e) {
                        droppedFiles = e.originalEvent.dataTransfer.files; // the files that were dropped
                        showFiles(droppedFiles);


                    });
            }


            // if the form was submitted

            $form.on('submit', function(e) {
                // preventing the duplicate submissions if the current one is in progress
                if ($form.hasClass('is-uploading')) return false;

                $form.addClass('is-uploading').removeClass('is-error');
                e.preventDefault();
                // ajax request
                var selectedFile = $('#input').files[0];

                var metadata = {
                    'contentType': file.type
                };
                storageRef.child('images/' + file.name).put(file, metadata).then(function(snapshot) {
                    console.log('Uploaded', snapshot.totalBytes, 'bytes.');
                    console.log(snapshot.metadata);
                    var url = snapshot.metadata.downloadURLs[0];
                    $form.removeClass("is-uploading").addClass("is-success");
                    console.log('File available at', url);
                    document.getElementById('linkbox').innerHTML = '<a href="' + url + '">' + url + '</a>';
                }).catch(function(error) {
                    console.error('Upload failed:', error);
                });


            });


            // restart the form if has a state of error/success

            $restart.on('click', function(e) {
                e.preventDefault();
                $form.removeClass('is-error is-success');
                $input.trigger('click');
            });

            // Firefox focus bug fix for file input
            $input
                .on('focus', function() {
                    $input.addClass('has-focus');
                })
                .on('blur', function() {
                    $input.removeClass('has-focus');
                });
        });
    </script>


</body>

</html>